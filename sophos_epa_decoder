<!--
  -  Sophos Endpoint Protection Advanced decoders
  -  Created by SWT <security@ties.k12.mn.us>.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<!--
Sophos Endpoint Protection Advanced

InsertedAt=2018-11-28 19:20:36; EventID=22745; EventTime=2018-11-28 19:20:32; EventTypeID=2; EventType=Adware or PUA; Name=PsExec; ReportingName=PsExec; UserName=TIES_ADMIN\dom000535; ActionID=116; Action=Blocked; ScanTypeID=201; ScanType=On access; SubTypeID=5; SubType=Hacking tool; ComputerName=PRINTACACS-01; ComputerDomain=TIES_ADMIN; ComputerIPAddress=10.255.101.29
InsertedAt=2018-11-28 19:20:36; EventID=22745; EventTime=2018-11-28 19:20:32; ActionTakenID=116; ActionTaken=Blocked; UserName=TIES_ADMIN\dom000535; ScannerTypeID=201; ScannerType=On access; StatusID=300; Status=Cleanable; ThreatTypeID=2; ThreatType=Adware or PUA; ThreatName=PsExec; FullFilePath=C:\Users\dom000535\Desktop\SysinternalsSuite\PsExec64.exe; ComputerName=PRINTACACS-01; ComputerDomain=TIES_ADMIN; ComputerIPAddress=10.255.101.29

 -->

<decoder name="sophos-epa">
   <prematch>InsertedAt=(\d*-\d*-\d* \d*:\d*:\d*); EventID=(\d*); </prematch>
</decoder>

<decoder name="sophos-epa-threats">
   <parent>sophos-epa</parent>
   <prematch offset="after_parent">EventTime=\d*-\d*-\d* \d*:\d*:\d*; ActionTakenID=\d*; ActionTaken=\w*; </prematch>
   <regex offset="after_parent">EventTime=(\d*-\d*-\d* \d*:\d*:\d*); ActionTakenID=(\d*); ActionTaken=(\w*); </regex>
   <order>Time, ActionTakenID, ActionTaken</order>
</decoder>

<decoder name="sophos-epa-threats">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">UserName=(\w*\\\w*); ScannerTypeID=(\d*); ScannerType=(\w*\s*\w*);</regex>
   <order>Username, ScannerTypeID, ScannerType</order>
</decoder>

<decoder name="sophos-epa-threats">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">StatusID=(\d*); Status=(\w*); ThreatTypeID=(\d*); ThreatType=(\w*\s*\w*\s*\w*); ThreatName=(\w*);</regex>
   <order>StatusID, Status, ThreatTypeID, ThreatType, ThreatName</order>
</decoder>

<decoder name="sophos-epa-threats">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">FullFilePath=(\w:\\*\w*\\\w*\\*\w*\\*\w*\\*\w*.\w*)</regex>
   <order>FilePath</order>
</decoder>

<decoder name="sophos-epa-threats">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">ComputerName=(\S*); ComputerDomain=(\S*); ComputerIPAddress=(\d*.\d*.\d*.\d*)</regex>
   <order>Hostname, Domain, IP</order>
</decoder>

<decoder name="sophos-epa-common-events">
   <parent>sophos-epa</parent>
   <prematch offset="after_parent">EventTime=\d*-\d*-\d* \d*:\d*:\d*; EventTypeID=\d*</prematch>
   <regex offset="after_parent">EventTime=(\d*-\d*-\d* \d*:\d*:\d*); EventTypeID=(\d*); </regex>
   <order>Time, EventTypeID</order>
</decoder>

<decoder name="sophos-epa-common-events">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">EventType=(\w*\s*\w*\s*\w*); Name=(\w*); ReportingName=(\w*);</regex>
   <order>EventType, ProgramName, ReportingName</order>
</decoder>

<decoder name="sophos-epa-common-events">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">UserName=(\w*\\\w*); ActionID=(\d*); Action=(\w*);</regex>
   <order>UserName, ActionID, Action</order>
</decoder>

<decoder name="sophos-epa-common-events">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">ScanTypeID=(\d*); ScanType=(\w*\s*\w*); SubTypeID=(\d*); SubType=(\w*\s*\w*);</regex>
   <order>ScanTypeID, ScanType, SubTypeID, SubType</order>
</decoder>

<decoder name="sophos-epa-common-events">
   <parent>sophos-epa</parent>
   <regex offset="after_parent">ComputerName=(\S*); ComputerDomain=(\S*); ComputerIPAddress=(\d*.\d*.\d*.\d*)</regex>
   <order>Hostname, Domain, IP</order>
</decoder>

